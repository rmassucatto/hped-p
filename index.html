<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HPed-P • Calculadora Peso por Idade e Sexo</title>
  <!-- Chart.js para criar o gráfico -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }
    header {
      background: #28a745;
      color: #fff;
      padding: 15px;
      font-size: 1.5rem;
      text-align: center;
      border-radius: 10px;
    }
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      max-width: 500px;
      margin: 0 auto;
    }
    label {
      font-weight: bold;
    }
    select,
    input[type="number"],
    button {
      width: 100%;
      padding: 8px;
      margin: 5px 0 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background: #28a745;
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #218838;
    }
    canvas {
      margin-top: 20px;
    }
    .zap {
      display: block;
      margin-top: 20px;
      text-align: center;
    }
    .zap a {
      background: #25D366;
      color: #fff;
      padding: 10px 20px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: bold;
    }
    /* Saída de texto */
    #saida {
      margin-top: 15px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <header>HPed-P • Calculadora de Peso</header>
  <div class="container">
    <label for="sexo">Sexo:</label>
    <select id="sexo">
      <option value="F">Feminino</option>
      <option value="M">Masculino</option>
    </select>

    <label for="idade">Idade:</label>
    <input type="number" id="idade" placeholder="Digite a idade">

    <label for="unidade">Unidade:</label>
    <select id="unidade">
      <option value="meses">Meses</option>
      <option value="anos">Anos</option>
    </select>

    <label for="peso">Peso do paciente (kg):</label>
    <input type="number" id="peso" step="0.01" placeholder="Digite o peso">

    <button onclick="calcular()">Calcular</button>

    <canvas id="grafico" height="200"></canvas>
    <div id="saida"></div>

    <div class="zap">
      <a href="https://wa.me/5515997067660" target="_blank">Falar no WhatsApp</a>
    </div>
  </div>

  <script>
  // -------------------------------------------------------------------------
  // Dados de referência
  //
  // Substitua os arrays abaixo pelos valores completos de suas tabelas CSV
  // peso_feminino_calculadora.csv e peso_masculino_calculadora.csv.
  // Cada elemento da lista deve conter o número de meses (age_months) e
  // o peso médio (mean) correspondente.
  //
  // Exemplo de estrutura:
  // dados.F = [
  //   { age_months: 3, mean: 5.898 },
  //   { age_months: 4, mean: 6.364 },
  //   ...
  // ];
  // dados.M = [
  //   { age_months: 3, mean: 6.390 },
  //   { age_months: 4, mean: 6.902 },
  //   ...
  // ];
  const dados = {
    F: [
      { age_months: 3,  mean: 5.898 },
      { age_months: 4,  mean: 6.364 },
      { age_months: 5,  mean: 6.810 },
      { age_months: 6,  mean: 7.237 },
      { age_months: 7,  mean: 7.645 },
      { age_months: 8,  mean: 8.035 },
      { age_months: 9,  mean: 8.408 },
      { age_months: 10, mean: 8.765 },
      { age_months: 11, mean: 9.435 },
      { age_months: 12, mean: 9.749 },
      { age_months: 13, mean: 10.051 },
      { age_months: 14, mean: 10.340 },
      { age_months: 15, mean: 10.618 },
      { age_months: 16, mean: 10.886 },
      { age_months: 17, mean: 11.143 },
      { age_months: 18, mean: 11.391 },
      { age_months: 19, mean: 11.631 },
      { age_months: 20, mean: 11.862 },
      { age_months: 21, mean: 12.086 },
      { age_months: 22, mean: 12.302 },
      { age_months: 23, mean: 12.512 },
      { age_months: 24, mean: 12.716 },
      { age_months: 25, mean: 12.915 },
      { age_months: 26, mean: 13.108 },
      { age_months: 27, mean: 13.297 },
      { age_months: 28, mean: 13.481 },
      { age_months: 29, mean: 13.662 },
      { age_months: 30, mean: 13.839 },
      { age_months: 31, mean: 14.012 },
      { age_months: 32, mean: 14.183 },
      { age_months: 33, mean: 14.352 },
      { age_months: 34, mean: 14.519 },
      { age_months: 35, mean: 14.683 },
      { age_months: 36, mean: 14.846 },
      { age_months: 37, mean: 15.008 },
      { age_months: 38, mean: 15.169 },
      { age_months: 39, mean: 15.328 },
      { age_months: 40, mean: 15.487 },
      { age_months: 41, mean: 15.645 },
      { age_months: 42, mean: 15.804 },
      { age_months: 43, mean: 15.962 },
      { age_months: 44, mean: 16.120 },
      { age_months: 45, mean: 16.278 },
      { age_months: 46, mean: 16.474 },
      { age_months: 47, mean: 16.595 },
      { age_months: 48, mean: 16.755 },
      { age_months: 49, mean: 16.915 },
      { age_months: 50, mean: 17.075 },
      { age_months: 51, mean: 17.235 },
      { age_months: 52, mean: 17.399 },
      { age_months: 53, mean: 17.562 },
      { age_months: 54, mean: 17.727 },
      { age_months: 55, mean: 17.892 },
      { age_months: 56, mean: 18.058 },
      { age_months: 57, mean: 18.225 },
      { age_months: 58, mean: 18.393 },
      { age_months: 59, mean: 18.561 },
      { age_months: 60, mean: 18.733 },
      { age_months: 61, mean: 18.904 },
      { age_months: 62, mean: 19.077 },
      { age_months: 63, mean: 19.251 },
      { age_months: 64, mean: 19.425 },
      { age_months: 65, mean: 19.601 },
      { age_months: 66, mean: 19.777 },
      { age_months: 67, mean: 19.955 },
      { age_months: 68, mean: 20.133 },
      { age_months: 69, mean: 20.313 },
      { age_months: 70, mean: 20.493 },
      { age_months: 71, mean: 20.674 },
      { age_months: 72, mean: 20.856 },
      { age_months: 73, mean: 21.039 },
      { age_months: 74, mean: 21.222 },
      { age_months: 75, mean: 21.407 },
      { age_months: 76, mean: 21.591 },
      { age_months: 77, mean: 21.777 },
      { age_months: 78, mean: 21.963 },
      { age_months: 79, mean: 22.149 },
      { age_months: 80, mean: 22.337 },
      { age_months: 81, mean: 22.524 },
      { age_months: 82, mean: 22.712 },
      { age_months: 83, mean: 22.901 },
      { age_months: 84, mean: 23.090 },
      { age_months: 85, mean: 23.280 },
      { age_months: 86, mean: 23.470 },
      { age_months: 87, mean: 23.660 },
      { age_months: 88, mean: 23.851 },
      { age_months: 89, mean: 24.042 },
      { age_months: 90, mean: 24.234 },
      { age_months: 91, mean: 24.424 },
      { age_months: 92, mean: 24.619 },
      { age_months: 93, mean: 24.810 },
      { age_months: 94, mean: 25.007 },
      { age_months: 95, mean: 25.202 },
      { age_months: 96, mean: 25.398 },
      { age_months: 97, mean: 25.594 },
      { age_months: 98, mean: 25.792 },
      { age_months: 99, mean: 25.991 },
      { age_months: 100, mean: 26.190 },
      { age_months: 101, mean: 26.390 },
      { age_months: 102, mean: 26.594 },
      { age_months: 103, mean: 26.796 },
      { age_months: 104, mean: 27.004 },
      { age_months: 105, mean: 27.212 },
      { age_months: 106, mean: 27.420 },
      { age_months: 107, mean: 27.634 },
      { age_months: 108, mean: 27.849 },
      { age_months: 109, mean: 28.066 },
      { age_months: 110, mean: 28.287 },
      { age_months: 111, mean: 28.510 },
      { age_months: 112, mean: 28.738 },
      { age_months: 113, mean: 28.969 },
      { age_months: 114, mean: 29.204 },
      { age_months: 115, mean: 29.444 },
      { age_months: 116, mean: 29.689 },
      { age_months: 117, mean: 29.939 },
      { age_months: 118, mean: 30.194 },
      { age_months: 119, mean: 30.456 },
      { age_months: 120, mean: 30.724 },
      { age_months: 121, mean: 30.999 },
      { age_months: 122, mean: 31.281 },
      { age_months: 123, mean: 31.571 },
      { age_months: 124, mean: 31.869 },
      { age_months: 125, mean: 32.176 },
      { age_months: 126, mean: 32.493 },
      { age_months: 127, mean: 32.820 },
      { age_months: 128, mean: 33.157 },
      { age_months: 129, mean: 33.506 },
      { age_months: 130, mean: 33.866 },
      { age_months: 131, mean: 34.239 },
      { age_months: 132, mean: 34.627 },
      { age_months: 133, mean: 35.025 },
      { age_months: 134, mean: 35.440 },
      { age_months: 135, mean: 35.866 },
      { age_months: 136, mean: 36.317 },
      { age_months: 137, mean: 36.780 },
      { age_months: 138, mean: 37.263 },
      { age_months: 139, mean: 37.763 },
      { age_months: 140, mean: 38.284 },
      { age_months: 141, mean: 38.823 },
      { age_months: 142, mean: 39.387 },
      { age_months: 143, mean: 39.972 }
    ],
    M: [
      { age_months: 3,  mean: 6.390 },
      { age_months: 4,  mean: 6.902 },
      { age_months: 5,  mean: 7.387 },
      { age_months: 6,  mean: 7.845 },
      { age_months: 7,  mean: 8.278 },
      { age_months: 8,  mean: 8.688 },
      { age_months: 9,  mean: 9.076 },
      { age_months: 10, mean: 9.443 },
      { age_months: 11, mean: 9.791 },
      { age_months: 12, mean: 10.120 },
      { age_months: 13, mean: 10.437 },
      { age_months: 14, mean: 10.726 },
      { age_months: 15, mean: 11.006 },
      { age_months: 16, mean: 11.272 },
      { age_months: 17, mean: 11.525 },
      { age_months: 18, mean: 11.765 },
      { age_months: 19, mean: 11.995 },
      { age_months: 20, mean: 12.213 },
      { age_months: 21, mean: 12.422 },
      { age_months: 22, mean: 12.622 },
      { age_months: 23, mean: 12.813 },
      { age_months: 24, mean: 12.999 },
      { age_months: 25, mean: 13.177 },
      { age_months: 26, mean: 13.349 },
      { age_months: 27, mean: 13.516 },
      { age_months: 28, mean: 13.676 },
      { age_months: 29, mean: 13.836 },
      { age_months: 30, mean: 13.994 },
      { age_months: 31, mean: 14.142 },
      { age_months: 32, mean: 14.290 },
      { age_months: 33, mean: 14.437 },
      { age_months: 34, mean: 14.582 },
      { age_months: 35, mean: 14.726 },
      { age_months: 36, mean: 14.869 },
      { age_months: 37, mean: 15.012 },
      { age_months: 38, mean: 15.154 },
      { age_months: 39, mean: 15.297 },
      { age_months: 40, mean: 15.440 },
      { age_months: 41, mean: 15.583 },
      { age_months: 42, mean: 15.728 },
      { age_months: 43, mean: 15.874 },
      { age_months: 44, mean: 16.022 },
      { age_months: 45, mean: 16.171 },
      { age_months: 46, mean: 16.322 },
      { age_months: 47, mean: 16.474 },
      { age_months: 48, mean: 16.629 },
      { age_months: 49, mean: 16.786 },
      { age_months: 50, mean: 16.945 },
      { age_months: 51, mean: 17.107 },
      { age_months: 52, mean: 17.271 },
      { age_months: 53, mean: 17.438 },
      { age_months: 54, mean: 17.607 },
      { age_months: 55, mean: 17.778 },
      { age_months: 56, mean: 17.952 },
      { age_months: 57, mean: 18.129 },
      { age_months: 58, mean: 18.308 },
      { age_months: 59, mean: 18.489 },
      { age_months: 60, mean: 18.673 },
      { age_months: 61, mean: 18.859 },
      { age_months: 62, mean: 19.048 },
      { age_months: 63, mean: 19.239 },
      { age_months: 64, mean: 19.432 },
      { age_months: 65, mean: 19.627 },
      { age_months: 66, mean: 19.824 },
      { age_months: 67, mean: 20.023 },
      { age_months: 68, mean: 20.224 },
      { age_months: 69, mean: 20.427 },
      { age_months: 70, mean: 20.631 },
      { age_months: 71, mean: 20.836 },
      { age_months: 72, mean: 21.043 },
      { age_months: 73, mean: 21.251 },
      { age_months: 74, mean: 21.461 },
      { age_months: 75, mean: 21.671 },
      { age_months: 76, mean: 21.882 },
      { age_months: 77, mean: 22.093 },
      { age_months: 78, mean: 22.305 },
      { age_months: 79, mean: 22.518 },
      { age_months: 80, mean: 22.731 },
      { age_months: 81, mean: 22.944 },
      { age_months: 82, mean: 23.158 },
      { age_months: 83, mean: 23.371 },
      { age_months: 84, mean: 23.584 },
      { age_months: 85, mean: 23.796 },
      { age_months: 86, mean: 24.009 },
      { age_months: 87, mean: 24.221 },
      { age_months: 88, mean: 24.432 },
      { age_months: 89, mean: 24.642 },
      { age_months: 90, mean: 24.853 },
      { age_months: 91, mean: 25.062 },
      { age_months: 92, mean: 25.271 },
      { age_months: 93, mean: 25.477 },
      { age_months: 94, mean: 25.682 },
      { age_months: 95, mean: 25.889 },
      { age_months: 96, mean: 26.094 },
      { age_months: 97, mean: 26.297 },
      { age_months: 98, mean: 26.500 },
      { age_months: 99, mean: 26.701 },
      { age_months: 100, mean: 26.902 },
      { age_months: 101, mean: 27.101 },
      { age_months: 102, mean: 27.300 },
      { age_months: 103, mean: 27.498 },
      { age_months: 104, mean: 27.696 },
      { age_months: 105, mean: 27.893 },
      { age_months: 106, mean: 28.089 },
      { age_months: 107, mean: 28.281 },
      { age_months: 108, mean: 28.481 },
      { age_months: 109, mean: 28.677 },
      { age_months: 110, mean: 28.874 },
      { age_months: 111, mean: 29.071 },
      { age_months: 112, mean: 29.269 },
      { age_months: 113, mean: 29.467 },
      { age_months: 114, mean: 29.669 },
      { age_months: 115, mean: 29.869 },
      { age_months: 116, mean: 30.073 },
      { age_months: 117, mean: 30.279 },
      { age_months: 118, mean: 30.488 },
      { age_months: 119, mean: 30.700 },
      { age_months: 120, mean: 30.916 },
      { age_months: 121, mean: 31.136 },
      { age_months: 122, mean: 31.360 },
      { age_months: 123, mean: 31.589 },
      { age_months: 124, mean: 31.824 },
      { age_months: 125, mean: 32.065 },
      { age_months: 126, mean: 32.313 },
      { age_months: 127, mean: 32.569 },
      { age_months: 128, mean: 32.832 },
      { age_months: 129, mean: 33.105 },
      { age_months: 130, mean: 33.387 },
      { age_months: 131, mean: 33.679 },
      { age_months: 132, mean: 33.983 },
      { age_months: 133, mean: 34.298 },
      { age_months: 134, mean: 34.627 },
      { age_months: 135, mean: 34.969 },
      { age_months: 136, mean: 35.325 },
      { age_months: 137, mean: 35.693 },
      { age_months: 138, mean: 36.087 },
      { age_months: 139, mean: 36.493 },
      { age_months: 140, mean: 36.920 },
      { age_months: 141, mean: 37.376 },
      { age_months: 142, mean: 37.853 },
      { age_months: 143, mean: 38.323 },
      { age_months: 144, mean: 38.836 }
    ]
  };

  // -------------------------------------------------------------------------
  // Função para desenhar o gráfico
  // Cria um gráfico com duas barras: a média da tabela e o peso do paciente.
  function renderChart(mean, paciente) {
    const ctx = document.getElementById('grafico').getContext('2d');
    const labels = ['Médio', 'Paciente'];
    const data = [Number(mean) || 0, Number(paciente) || 0];

    // Destrói o gráfico anterior, se existir
    if (window.chart) {
      window.chart.destroy();
    }

    window.chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [
          {
            data,
            backgroundColor: ['#4da6ff', '#ff9933'],
            borderRadius: 12,
            borderSkipped: false
          }
        ]
      },
      options: {
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  }

  // -------------------------------------------------------------------------
  // Função principal de cálculo
  // Lê os valores dos campos, valida e calcula a diferença entre o peso do
  // paciente e a média da tabela. Em seguida, renderiza o gráfico e mostra a
  // mensagem na tela.
  function calcular() {
    const sexo = document.getElementById('sexo').value;
    const idadeStr = String(document.getElementById('idade').value || '').trim().replace(',', '.');
    const unidade = document.getElementById('unidade').value;
    const pesoStr = String(document.getElementById('peso').value || '').trim().replace(',', '.');

    const idadeNum = Number(idadeStr);
    const pesoPaciente = Number(pesoStr);

    // Validação básica
    if (!Number.isFinite(idadeNum)) {
      if (window.chart) { window.chart.destroy(); window.chart = null; }
      document.getElementById('saida').innerHTML = '<span style="color:#ff4d4f">Digite uma idade válida.</span>';
      return;
    }
    if (!Number.isFinite(pesoPaciente)) {
      if (window.chart) { window.chart.destroy(); window.chart = null; }
      document.getElementById('saida').innerHTML = '<span style="color:#ff4d4f">Digite um peso válido (use ponto ou vírgula).</span>';
      return;
    }

    // Converter para meses se necessário
    let idadeMesesRaw = idadeNum;
    if (unidade === 'anos') {
      idadeMesesRaw = Math.round(idadeNum * 12);
    }
    idadeMesesRaw = Math.round(idadeMesesRaw);

    const tabela = sexo === 'M' ? dados.M : dados.F;
    if (!Array.isArray(tabela) || tabela.length === 0) {
      if (window.chart) { window.chart.destroy(); window.chart = null; }
      document.getElementById('saida').innerHTML = '<span style="color:#ff4d4f">Não há dados carregados para este sexo.</span>';
      return;
    }

    const minAge = tabela[0].age_months;
    const maxAge = tabela[tabela.length - 1].age_months;
    const idadeMeses = Math.max(minAge, Math.min(maxAge, idadeMesesRaw));

    // Função auxiliar para encontrar o valor mais próximo
    function nearestRow(arr, age) {
      let best = arr[0];
      let bestDiff = Math.abs(arr[0].age_months - age);
      for (const r of arr) {
        const d = Math.abs(r.age_months - age);
        if (d < bestDiff) {
          best = r;
          bestDiff = d;
        }
      }
      return best;
    }
    const row = nearestRow(tabela, idadeMeses);
    if (!row || !Number.isFinite(row.mean)) {
      if (window.chart) { window.chart.destroy(); window.chart = null; }
      document.getElementById('saida').innerHTML = '<span style="color:#ff4d4f">Não foi possível encontrar a referência desta idade.</span>';
      return;
    }

    // Desenhar o gráfico
    renderChart(row.mean, pesoPaciente);

    // Calcular e mostrar a diferença
    const diff = pesoPaciente - row.mean;
    const status = diff === 0 ? 'igual' : diff > 0 ? 'acima' : 'abaixo';
    document.getElementById('saida').innerHTML =
      'Referência: <strong>' + row.age_months + '</strong> meses • Média: <strong>' + row.mean.toFixed(2) + ' kg</strong><br>' +
      'Paciente: <strong>' + pesoPaciente.toFixed(2) + ' kg</strong> — ' +
      '<strong>' + status + '</strong> da média por <strong>' + Math.abs(diff).toFixed(2) + ' kg</strong>.';

    // Armazenar os últimos valores para conveniência (opcional)
    localStorage.setItem('hped_last', JSON.stringify({ sexo, idade: idadeNum, unidade, pesoPaciente }));
  }
  </script>
</body>
</html>